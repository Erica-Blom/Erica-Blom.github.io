<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui, maximum-scale=1, user-scalable=no">
  <title>Telia MVP</title>
  <style>

    df-markdown-message{
      width:304px
    }


  </style>
  <script src="https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v1/df-messenger.js"></script>
</head>

<body>
   <df-messenger
  location="europe-west1"
  project-id="telia-se-digitalchannels"
  agent-id="6094ac83-e353-4e6e-917c-afb5c92062bb"
  language-code="sv"
  max-query-length="-1"
  allow-feedback="all">
    <df-messenger-chat-bubble chat-title="Telia MVP" allow-fullscreen="none" anchor="bottom"  chat-collapse-icon="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath fill='white' d='M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z'%3E%3C/path%3E%3Cpath d='M0 0h24v24H0z' fill='none'%3E%3C/path%3E%3C/svg%3E%0A" chat-icon="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none'%3E%3Cpath d='M10.4596 17.121L7.9441 16.0077L10.3908 14.9393C10.3908 14.9393 10.3909 14.9393 10.3909 14.9393C11.53 14.442 12.4431 13.5318 12.9407 12.3876C12.9407 12.3875 12.9408 12.3874 12.9408 12.3873L14.0023 9.95289L15.0642 12.3882C15.561 13.5277 16.4706 14.4415 17.6144 14.9396C17.6145 14.9396 17.6146 14.9397 17.6147 14.9397L20.0494 16.0026L17.6139 17.0659C17.6138 17.0659 17.6138 17.0659 17.6138 17.0659C16.475 17.563 15.562 18.473 15.0643 19.6168C15.0643 19.6169 15.0643 19.6169 15.0642 19.6169C15.0641 19.6173 15.064 19.6176 15.0638 19.6179L14.0088 22.0365L12.9985 19.6876C12.9984 19.6873 12.9983 19.687 12.9981 19.6868C12.5067 18.5409 11.5997 17.6247 10.4603 17.1213C10.4603 17.1213 10.4602 17.1212 10.4602 17.1212C10.46 17.1211 10.4598 17.121 10.4596 17.121Z' stroke='%23F5E0FF' stroke-width='2'/%3E%3Cpath d='M9.89047 6.83371L8.00695 6.01142C7.55143 5.81309 7.18864 5.44891 6.99044 4.99427L6.16865 3.1096C6.1049 2.96347 5.89742 2.96347 5.83367 3.1096L5.01188 4.99427C4.81368 5.45007 4.44972 5.81309 3.99536 6.01142L2.10953 6.83487C1.96349 6.89866 1.96349 7.10511 2.10953 7.1689L4.02782 8.01787C4.48218 8.21851 4.84381 8.58385 5.0397 9.04081L5.83483 10.8895C5.89742 11.0368 6.10606 11.0368 6.16981 10.8895L6.99044 9.00834C7.18864 8.55254 7.55259 8.18952 8.00695 7.99119L9.89047 7.1689C10.0365 7.10511 10.0365 6.8975 9.89047 6.83371Z' fill='%23F5E0FF'/%3E%3Cpath d='M13.9452 1.91686L13.0035 1.50571C12.7757 1.40655 12.5943 1.22446 12.4952 0.997137L12.0843 0.0548005C12.0524 -0.0182668 11.9487 -0.0182668 11.9168 0.0548005L11.5059 0.997137C11.4068 1.22504 11.2249 1.40655 10.9977 1.50571L10.0548 1.91744C9.98174 1.94933 9.98174 2.05255 10.0548 2.08445L11.0139 2.50893C11.2411 2.60926 11.4219 2.79193 11.5198 3.02041L11.9174 3.94476C11.9487 4.01841 12.053 4.01841 12.0849 3.94476L12.4952 3.00417C12.5943 2.77627 12.7763 2.59476 13.0035 2.4956L13.9452 2.08445C14.0183 2.05255 14.0183 1.94875 13.9452 1.91686Z' fill='%23F5E0FF'/%3E%3C/svg%3E%0A">
    </df-messenger-chat-bubble>
  </df-messenger>

  <script>
    var trigger = document.querySelector("df-messenger-chat-bubble");
    var chat = trigger.shadowRoot.querySelector("df-messenger-chat");
    var messageList = chat.shadowRoot.querySelector("df-messenger-message-list");
    var messengerBotUtterance = messageList.shadowRoot?.querySelector(".entry.bot:last-child df-messenger-utterance");
    var messengerFeedback = messengerBotUtterance?.shadowRoot?.querySelector('df-messenger-feedback');
    var citations = messengerBotUtterance?.shadowRoot?.querySelector("df-citations");

    document.addEventListener('DOMContentLoaded', () => {
      var screenWidth = window.innerWidth;
      var styleUserInput = document.createElement('style');
      var messageListStyle = document.createElement('style');
      var chatbubbleStyle = document.createElement('style');
      var privacyMessage = document.createElement('div');
      var linkToPage = document.createElement('a');

      linkToPage.setAttribute('href', 'https://www.telia.se/')
      linkToPage.setAttribute('target', '_blank')
      linkToPage.innerText = 'Läs mer om detta och hur vi hanterar personuppgifter';

      chatbubbleStyle.textContent = `
        .bubble{position:absolute !important; bottom:20px;right:20px}
      .chat-wrapper{position:initial !important; bottom:0 !important}

      .container{position:relative}
      

      `

      styleUserInput.textContent = `
        .input-box-wrapper{border:1px solid rgba(0, 0, 0, 0.44);background-color:#fff !important; overflow-y:unset !important; border-radius:3px}
        .input-container{padding:10px}
        #send-icon-button{background-color:#fff !important;}
        #send-icon{margin-top:8px !important; margin-bottom:6px}
    
        .send-icon-button-wrapper .action-button{border-radius:0px !important}
      `
      privacyMessage.setAttribute('class', 'privacyMessage')
      privacyMessage.innerText = 'Svaren i chatten är AI-genererade och kan behöva kontrolleras. '

      messageListStyle.textContent = `
        .privacyMessage{padding: 10px 20px 10px 20px};
      `

      var messageArea = chat.shadowRoot.querySelector('.message-list-wrapper df-messenger-message-list')
      var messageList = messageArea.shadowRoot.querySelector('.message-list-wrapper')
      var userInput = chat.shadowRoot.querySelector('df-messenger-user-input')
      var messages = messageList.querySelector('#message-list')
      privacyMessage.appendChild(linkToPage)
      console.log(messageList)
      if (messages.firstChild) {
        messages.insertBefore(privacyMessage, messages.firstChild);
      } else {
        messages.appendChild(privacyMessage);
        }

      
      messageArea.shadowRoot.appendChild(messageListStyle)
      userInput.shadowRoot.appendChild(styleUserInput);
      //checkElementsExist();
      console.log(screenWidth)
      var style = document.createElement('style');
      if(screenWidth <= 981){

    
       style.innerHTML = `
                df-messenger {
                    z-index: 999;
                    position: fixed;
                    --df-messenger-titlebar-background: #29003E;
                    --df-messenger-chat-background: #fff;
                    --df-messenger-internal-chat-bubble-size-offset: 0px;
                    --df-messenger-font-family: "Telia Sans";
                    --df-messenger-chat-border: rgba(0, 0, 0, 0.16) solid 1px;
                    bottom: 0px;
                    right: 0px;
                }

                df-messenger-chat-bubble {
                  --df-messenger-chat-bubble-background: #29003E;
                  --df-messenger-chat-bubble-icon-size:40px;
                  --df-messenger-chat-window-height: calc(100vh);
                  --df-messenger-chat-window-width:calc(100vw);
                  --df-messenger-chat-background: #F5F5FA;
                  --df-messenger-message-bot-background: #F5E0FF;
                  --df-messenger-message-bot-font-color: #222222;
                  --df-messenger-message-bot-font-weight: 400;
                  --df-messenger-message-font-size: 16px;
                  --df-messenger-message-user-background: #fff;
                  --df-messenger-message-user-font-color: #222222;
                  --df-messenger-message-user-font-weight: 400;
                  --df-messenger-message-border-radius: 8px;
                  --df-messenger-send-icon-color: #6D02A3;
                  --df-messenger-input-padding: 0px;
                  --df-messenger-input-font-size: 16px;
                  --df-messenger-message-feedback-icon-font-color: #6D02A3;
                  --df-messenger-citations-font-color: #6D02A3;
                  --df-messenger-citations-border-color: #6D02A3;
                  --df-messenger-citations-border-radius: 50px;
                  --df-messenger-citations-font-size: 16px;
                  --df-messenger-citations-message-font-size: 14px;
                  --df-messenger-input-font-family:'Telia Sans';
                  --df-messenger-input-box-padding:10px 40px 12px 10px;
                  --df-messenger-input-background:#F5F5FA;
                  --df-messenger-input-box-background:#ffffff;
                  --df-messenger-message-user-writing-image-width:250px;
                  --df-messenger-focus-color:#6D02A3;
                  --df-messenger-titlebar-padding:5px 15px;
                  --df-messenger-citations-background:#F5F5FA;
                  --df-messenger-send-icon-offset-y:0px;
                  bottom: 0px;
                }
            `;
            trigger.shadowRoot.appendChild(chatbubbleStyle);
      }else{
        style.innerHTML =
        `
          df-messenger {
            z-index: 999;
            position: fixed;
            --df-messenger-titlebar-background: #29003E;
            --df-messenger-chat-background: #fff;
            --df-messenger-internal-chat-bubble-size-offset: 50px;
            --df-messenger-font-family: "Telia Sans";
            --df-messenger-chat-border: rgba(0, 0, 0, 0.16) solid 1px;
            bottom: 16px;
            right: 16px;
          }
          df-messenger-chat-bubble {
            --df-messenger-chat-bubble-background: #29003E;
            --df-messenger-chat-bubble-icon-size:40px;
            --df-messenger-chat-window-height: calc(100vh - 200px);
            --df-messenger-chat-window-width:360px;
            --df-messenger-chat-background: #F5F5FA;
            --df-messenger-message-bot-background: #F5E0FF;
            --df-messenger-message-bot-font-color: #222222;
            --df-messenger-message-bot-font-weight: 400;
            --df-messenger-message-font-size: 16px;
            --df-messenger-message-user-background: #fff;
            --df-messenger-message-user-font-color: #222222;
            --df-messenger-message-user-font-weight: 400;
            --df-messenger-message-border-radius: 8px;
            --df-messenger-send-icon-color: #6D02A3;
            --df-messenger-input-padding: 0px;
            --df-messenger-input-font-size: 16px;
            --df-messenger-message-feedback-icon-font-color: #6D02A3;
            --df-messenger-citations-font-color: #6D02A3;
            --df-messenger-citations-border-color: #6D02A3;
            --df-messenger-citations-border-radius: 50px;
            --df-messenger-citations-font-size: 16px;
            --df-messenger-citations-message-font-size: 14px;
            --df-messenger-input-font-family:'Telia Sans';
            --df-messenger-input-box-padding:10px 40px 12px 10px;
            --df-messenger-input-background:#F5F5FA;
            --df-messenger-input-box-background:#ffffff;
            --df-messenger-message-user-writing-image-width:250px;
            --df-messenger-focus-color:#6D02A3;
            --df-messenger-titlebar-padding:5px 15px;
            --df-messenger-citations-background:#F5F5FA;
            --df-messenger-send-icon-offset-y:0px
          }
        `
        
      }
      document.head.appendChild(style);

    });

    window.addEventListener('df-response-received', (event) => {
     // setTimeout(checkFeedback, 100)
    });

    window.addEventListener('df-url-suggested', (event) => {
      messageList = chat.shadowRoot.querySelector("df-messenger-message-list");
      messengerBotUtterance = messageList.shadowRoot.querySelector(".entry.bot:last-child df-messenger-utterance");

      setTimeout(styleCitation, 100)
    });
    function checkElementsExist(){
      console.log('Check element exist')
      var messengerBotUtteranceList = messageList.shadowRoot?.querySelectorAll(".entry.bot df-messenger-utterance");
      var messengerFeedbackList = messengerBotUtterance?.shadowRoot?.querySelectorAll('df-messenger-feedback');
      var citationsList = messengerBotUtterance?.shadowRoot?.querySelectorAll("df-citations");
      var citationsMessage = citations?.shadowRoot.querySelectorAll('.citations-message');
      console.log(citationsList)
      if(citationsList?.length > 0){
        citationsList.forEach(citation => {
          styleCitations = document.createElement('style');
          styleCitations.textContent = `
            .citations-list .citation span.title{white-space:break-spaces !important}
            .citations-list .citation span.title:after{content:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='16' viewBox='0 -3 18 12' fill='none'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M17.9 7.00001C17.9 7.2387 17.8052 7.46762 17.6364 7.6364L12.1364 13.1364C11.7849 13.4879 11.2151 13.4879 10.8636 13.1364C10.5121 12.7849 10.5121 12.2151 10.8636 11.8636L14.8272 7.90001L1 7.90001C0.502945 7.90001 0.100002 7.49706 0.100002 7C0.100002 6.50295 0.502945 6.1 1 6.1L14.8272 6.10001L10.8636 2.1364C10.5121 1.78493 10.5121 1.21508 10.8636 0.86361C11.2151 0.512138 11.7849 0.512138 12.1364 0.86361L17.6364 6.36361C17.8052 6.53239 17.9 6.76131 17.9 7.00001Z' fill='%236D02A3'/%3E%3C/svg%3E"); margin-left:10px; margin-right:10px}
            .citations-list .citation svg{display:none}
          `;
          citations.shadowRoot.appendChild(styleCitations)
        });
        citationsMessage.forEach(message => {
          citationsMessage.innerText = 'LÄS MER HÄR:'
        });
      }
    }
    function checkFeedback() {
      messageList = chat.shadowRoot.querySelector("df-messenger-message-list");
      messengerBotUtterance = messageList.shadowRoot.querySelector(".entry.bot:last-child df-messenger-utterance");
      messengerFeedback = messengerBotUtterance.shadowRoot.querySelector('df-messenger-feedback')

      var messengerBadFeedback = messengerFeedback.shadowRoot.querySelector('.thumbs-down');
      messengerBadFeedback.addEventListener('click', function () {
        changeFeedbackText();
      })
    }

    function changeFeedbackText() {
      var feedbackTitle = messengerFeedback.shadowRoot.querySelector('.feedback .feedback-box .feedback-title');
      feedbackTitle.innerText = 'Varför valde du detta alternativ?'

      var feedbackSubtitle = messengerFeedback.shadowRoot.querySelector('.feedback .feedback-box .feedback-subtitle');
      feedbackSubtitle.innerText = '(valfritt)'

      var feedbackReason = messengerFeedback.shadowRoot.querySelectorAll('.feedback .feedback-box .feedback-reason-chip');
      feedbackReason[0].innerText = 'Irrelevant';
      feedbackReason[1].innerText = 'Felaktigt svar';
      feedbackReason[2].innerText = 'Osäker';

      var privacyNotice = messengerFeedback.shadowRoot.querySelector('.feedback .feedback-box .privacy-notice-row');
      privacyNotice.innerText = 'Vänligen skriv inga personliga eller känsliga uppgifter';

      var feedbackSubmitButton = messengerFeedback.shadowRoot.querySelector('.feedback .feedback-box button.feedback-submit');
      feedbackSubmitButton.innerText = 'Skicka'
    }

    function styleCitation() {
      messageList = chat.shadowRoot.querySelector("df-messenger-message-list");
      messengerBotUtterance = messageList.shadowRoot.querySelector(".entry.bot:last-child df-messenger-utterance");
      citations = messengerBotUtterance.shadowRoot.querySelector("df-citations")
      styleCitations = document.createElement('style');
      styleCitations.textContent = `
        .citations-list .citation span.title{white-space:break-spaces !important}
        .citations-list .citation span.title:after{content:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='16' viewBox='0 -3 18 12' fill='none'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M17.9 7.00001C17.9 7.2387 17.8052 7.46762 17.6364 7.6364L12.1364 13.1364C11.7849 13.4879 11.2151 13.4879 10.8636 13.1364C10.5121 12.7849 10.5121 12.2151 10.8636 11.8636L14.8272 7.90001L1 7.90001C0.502945 7.90001 0.100002 7.49706 0.100002 7C0.100002 6.50295 0.502945 6.1 1 6.1L14.8272 6.10001L10.8636 2.1364C10.5121 1.78493 10.5121 1.21508 10.8636 0.86361C11.2151 0.512138 11.7849 0.512138 12.1364 0.86361L17.6364 6.36361C17.8052 6.53239 17.9 6.76131 17.9 7.00001Z' fill='%236D02A3'/%3E%3C/svg%3E"); margin-left:10px; margin-right:10px}
        .citations-list .citation svg{display:none}

      `;
      citations.shadowRoot.appendChild(styleCitations)
      changeCitationText(citations)
    }

  </script>
</body>

</html>
